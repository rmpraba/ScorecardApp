<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">

<dom-module id="employe-category-creation-card">
  <template>
    <style>
      :host {
        display: block;
      }
      .card1
      {
        margin-left:5%;
        margin-top: 4%;
      }
      .card2
      {
        margin-left:40%;
         margin-top:-17%;
      }
      .outcard
      {
      width:25% 
      margin-left:5.0em;
      }
       .innercard
       {     
        @apply(--layout-horizontal);
        width:100%
        margin-left:2.5em;
     }
     .innercard1
     {
       @apply(--layout-horizontal);
       width:100%
       margin-left:5.0em;
     }
     .tt
     {
      width:70%;
     }

     .outercard
      {
        @apply(--layout-horizontal);
        border-radius: 10px;
        border: 2px solid #6699ff;
        padding: 20px;
        margin-top: 6%;
        width: 35%;
        margin-left: 30%;
        min-height: 300px;
      }
       .subbutton paper-button
      {
        @apply(--layout-right);
        background-color: #363636;
        color: #ffffff;                
        width: 8%;
        margin-left: 60%;
        margin-top: 4%;
      }
      .new1
      {
        @apply(--layout-horizontal);
        margin-left: 10%;
      }
    </style>

    <div>
      <CENTER>
        <h3><b>EMPLOYEE TO GRADE</b></h3>
      </CENTER>
    </div>

    <div>
      <div class="outercard">
        <table>
          <div>
            <template is="dom-repeat" items="{{empschoolarr}}" as="view">
              <emp-category-get-card empschooltypeids="{{view.school_type_name}}" empschoolnames="{{view.school_type_id}}"></emp-category-get-card>
            </template>

            <div class="new1" style="margin-left:10%">
              <paper-dropdown-menu  label="select the grade">
                <paper-menu id="empgradeid" class="dropdown-content"   on-iron-select="fnselectgrade">
                  <template is="dom-repeat" items="{{empschoolgrads}}">
                    <paper-item value="{{item.grade_id}}">{{item.grade_name}}</paper-item>
                  </template>    
                </paper-menu>
              </paper-dropdown-menu>
            </div> 
            
            <div class="new2" style="margin-left:10%">
              <paper-dropdown-menu  label="select the employee">
                <paper-menu id="employeeidz" class="dropdown-content"   on-iron-select="fnemployeename">
                  <template is="dom-repeat" items="{{empschoolnamesarr}}">
                    <paper-item value="{{item.emp_id}}">{{item.emp_name}}</paper-item>
                  </template>    
                </paper-menu>
              </paper-dropdown-menu>
            </div> 
        </table>
      </div>
   
      <div>
        <table class="table table-bordered" style="margin-top:5%">
          <div class="container">
            <thead> 
              <tr>
                <th></th>
                <th class="innercard">
                  <template is="dom-repeat" items="{{setsectionname}}" as="view">
                    <h4 style="margin-left:6.5%;">{{view.subjectarr}}</h4>
                  </template>
                </th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              <template is="dom-repeat" items="{{allarrr}}" as="view">
                <tr>
                  <td class="outcard"> 
                    <h4>{{view.subject_name}}</h4>
                  </td>
                  <td class="innercard">
                    <template is="dom-repeat" items="{{view.subject}}" as="s">
                      <emp-grade-get-card employeesectionidz="{{s.section_id}}" id="{{s.id}}" employeesubjectz="{{view.subject_name}}"  empsubjectidz="{{view.subjectid}}" employeesectionnamez="{{s.section_name}}" employeeidz="{{empselectid}}" empgradeidz="{{setgradeidz}}" >
                      </emp-grade-get-card>
                    </template>
                  </td>
                  <td></td>
                </tr>
              </template>
            </tbody>
          </div>
        </table>
      </div>
            <div class="subbutton">
              <paper-button on-click="fnsubmit">Submit</paper-button> 
            </div>
    </div>  

       

      <master-ui-service id="uiservice"></master-ui-service>

    <iron-ajax        
        id="fnselectgradezajax"
        url="{{fnselectgradezurl}}"
        params="{{fnselectgradezparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="fnselectgradezResponse"
        debounce-duration="300">
    </iron-ajax>
    <iron-ajax        
        id="fnemployeenamezajax"
        url="{{fnemployeenamezurl}}"
        params="{{fnemployeenamezparam}}"
        handle-as="json"
        content-type="application/json"
        method="post"
        on-response="fnemployeenamezResponse"
        debounce-duration="300">
    </iron-ajax>
 
  </template>

  <script>
  (function() {
    'use strict';
  var empnamearrr=[];
  var sectionnamearr=[];
  var empsectionarr=[];
    Polymer({
      is: 'employe-category-creation-card',
        fnschoolempnames:function(arr){
          this.empschoolnamesarr=arr;
        },  
        fnschoolempgrade:function(arr){
          this.empschoolgrads=arr;
        },
        fnselectgrade:function(e){
               this.setgradeid=e.target.selectedItem.textContent.trim();
         this.setgradeidz=e.target.selectedItem.value;
         this.fnselectgradezurl=sessionStorage.getItem("addrinfo")+"/tranfersection-service";
          var obj={"setgradeid":"","school_id":""};
          obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
          obj.setgradeid=this.setgradeid;
          this.fnselectgradezparam=obj;
          alert(JSON.stringify(obj));
          this.$.fnselectgradezajax.generateRequest();
          },
          fnselectgradezResponse:function(e){
               sectionnamearr=e.detail.response.returnval;
                 alert(JSON.stringify(sectionnamearr));
     },
     fnsubmit:function(e){
      this.$.uiservice.fnsavesection(empsectionarr);
      document.querySelector('emp-grade-get-card').Fngradecleansection(); 

     },
     fnsetempsection:function(arr){
      empsectionarr=arr;
    },
    fnemployeename:function(e){
         this.empselectid=e.target.selectedItem.value;
          this.fnemployeenamezurl=sessionStorage.getItem("addrinfo")+"/empmappingsubject-service";
          var obj={"empselectid":"","school_id":""};
          obj.empselectid=this.empselectid;
          obj.school_id=sessionStorage.getItem("curr_sess_loggedschoolid");
          this.fnemployeenamezparam=obj;
          alert(JSON.stringify(obj));
          this.$.fnemployeenamezajax.generateRequest();
         },
     
      fnemployeenamezResponse:function(e){
      empnamearrr=e.detail.response.returnval;
         alert(JSON.stringify(sectionnamearr));
          alert(JSON.stringify(empnamearrr));
       
  var setarr=[];
            for(var i=0;i<sectionnamearr.length;i++){
                          var section_name=sectionnamearr[i].section;
                            var obj={"subjectarr":""};
                                obj.subjectarr=section_name;
                               setarr.push(obj);
                              // alert(JSON.stringify(obj));
                          }
               //    alert(JSON.stringify(setarr));
                   this.setsectionname=setarr;

          var generatearr=[];
         var subarr=[];
                for(var j=0;j<empnamearrr.length;j++){
                     for(var i=0;i<sectionnamearr.length;i++){
                    var subjectid=empnamearrr[j].subjectid;
                     var subject_name=empnamearrr[j].subject;
                         
                         var obj={"subjectid":"","subject_name":"","section_id":"","section_name":""}; 
                           var section_id=sectionnamearr[i].id;
                          var section_name=sectionnamearr[i].section;

                           obj.section_name=section_name;
                           obj.subject_name=subject_name;
                           obj.section_id=section_id;
                           obj.subjectid=subjectid;
                           generatearr.push(obj);
                        }}//alert(JSON.stringify(generatearr));
        var a=[];
        var overall=[];
       for(var k=0;k<generatearr.length;k++)
       {       
         var nameobj={"subjectid":"","subject_name":""};
         nameobj.subjectid=generatearr[k].subjectid; 
         nameobj.subject_name=generatearr[k].subject_name; 
         var obj={"section_id":"","section_name":""};
        // obj.Grade_name=generatearr[k].gradename;
        obj.section_id=generatearr[k].section_id;
        obj.section_name=generatearr[k].section_name;
        obj.id=generatearr[k].subjectid+generatearr[k].section_id;
        a.push(obj);
        for(var l=k+1;l<generatearr.length;l++)
        {
           if(generatearr[k].subject_name==generatearr[l].subject_name)
           {
             var obj1={"section_id":"","section_name":""}
             //obj1.Grade_name=generatearr[l].gradename;
             obj1.section_id=generatearr[l].section_id;
             obj1.section_name=generatearr[l].section_name;
             obj1.id=generatearr[k].subjectid+generatearr[l].section_id;

             //alert('1');
           //  alert(JSON.stringify(obj1));
             a.push(obj1);
             //alert(JSON.stringify(a));
             generatearr.splice(l,1);
             l--;
           // alert(JSON.stringify(generatearr));
         }}
           nameobj.subject=a;
           overall.push(nameobj);
          // alert(JSON.stringify(obj1));
           a=[];

       }
    //alert(JSON.stringify(overall));
     this.$.uiservice.empgetsectionvalues(this.setgradeidz,this.empselectid);
    this.allarrr=overall;
     // overall.splice(0,1);
        /* this.bigarr=overall;
         overall.splice();
         generatearr=[];
         this.$.uiservice.fngetThefunction();
        */

















}
       });
      
      })();
  </script>
</dom-module>
